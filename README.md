# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с TS компонентами
- src/common/ — папка с TS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Типы данных

#### Интерфейс карточки

```
    interface IItem {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number;
	index?: number;
}
```

#### интерфейс товара

```
interface IProductsList {
	items: IItem[];
	preview: string | null;
}
```

#### информация о товарах в корзине

```
 type IBasket = Pick<IItem, 'title' | 'price'>;

```

#### интерфейс корзины

```
interface IBasketInfo {
	list: HTMLElement[];
	total: number;
}
```

#### форма ввода информации о способе оплаты и адресе

```
interface IOrderFormData {
	payment: string;
	address: string;
}
```

#### форма ввода контактных данных пользователя

```
interface IBuyerInfo {
	email: string;
	phone: string;
}
```

#### данные для заказа

```
type IOrderAndBuyerInfo = IOrderFormData & IBuyerInfo;

 type IOrderData = IOrderAndBuyerInfo & {
	total: number;
	items: string[];
}
```

#### ошибки в форме

```
 type IFormError = Partial<IOrderAndBuyerInfo>
```

#### валидация

```
interface IOrderValidation {
	CheckValidation(data: Record<keyof IOrderFormData, string>): boolean;
}
```

```
interface IBuyerInfoValidator {
	CheckValidation(data: Record<keyof IBuyerInfo, string>): boolean;
}
```

#### интерфейс модального окна

```
 interface IModal {
	content: HTMLElement;
}
```

#### форма успешной оплаты

```
 interface ICompletedOrder {
	id: string;
	total: number;
}
```

```
 interface IFormSubmissionResult {
	total: number;
}
```

#### данные о магазине

```
 interface IAppInfo {
	catalog: IItem[];
	cart: IItem[];
	order: IOrderAndBuyerInfo;
	formError: IFormError;
	events: IEvents;
}
```

#### данные формы

```
interface IFormInfo {
	valid: boolean;
	errors: string[];
	address: string;
	payment: string;
	phone: string;
	email: string;
}

```

## Архитектура приложения

Код приложения разделён на 3 слоя согласно парадигме MVP:

Слой данных Modal отвечает за хранение и изменение данных, слой представления Viev отвечает за отображение данных на странице, cлой P отвечает за связь данных и представления, использует событийно ориентированный подход, в нем происходит работа с данными и представлением находится в основном скрипте приложения index.ts.

## Классы

#### EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Конструктор:

- `constructor() {this.\_events = new Map<EventName, Set<Subscriber>>();}` - выполняет инициализацию объекта, создавая пустую структуру данных для хранения событий

Поля:

-`events = new Map<EventName, Set<Subscriber>>()` - используется для хранения информации о событиях и их подписчиках
Основные методы, реализуемые классом описаны интерфейсом IEvents:

- `on` - установка обработчика на событие
- `off` - снятие обработчика с события
- `emit` - инициализация события
- `rigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие
- `onAll` - установка слушашателя на все события
- `offAll` - сброс всех обработчиков с события

#### Api

Класс представляет собой универсальный инструмент для взаимодействия с веб-сервисами. Он инкапсулирует логику HTTP-запросов, обеспечивая удобный интерфейс для отправки и получения данных.

Поля:

- `baseUrl`: Строковая перекменная, хранящая базовый URL веб-сервиса.
- `options`: Объект настроек запроса, включающий заголовки, необходимые для корректной отправки данных.

Конструктор:

- Принимает `baseUrl` и необязательные `options`, инициализируя базовый URL и настройки запроса.

Методы класса:

- `handleResponse`: Защищенный метод, обрабатывающий ответ от сервера, преобразуя его в JSON и управляя ошибками.
- `get`: Метод для выполнения GET-запроса к указанному URI.
- `post`:- Принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове

#### ApiData

Класс Наследуетcя от Api

Поля:

- `cdn: string` - используется для формирования полного пути к изображениям продуктов

Конструктор:

- `constructor(baseUrl: string, options: RequestInit = {}):`

Методы:

- `getProductList` - выполняет GET запрос, возвращает промис с массивом товаров
- `postOrder` - выполняет POST запрос, возвращает промис с ответом сервера

#### AppState

Класс отвечает за хранение и логику работы с данными приложения

Поля:

- `productList: IItem[]` - массив карточек продуктов
- `basket: IItem[]` - товары, добавленные пользователем в корзину
- `preview: string | null` - просмотр подробной информации о продукте
- `order: IOrderAndBuyerInfo` - информация о заказе
- `orderErrors: IFormError` - сообщение об ошибке при вводе данных в форме
- `formType: 'order' | 'contacts'` - тип формы

Методы:

- `setProductList()` - вывод списка продуктов
- `addToBasket()` - добавление товара в корзину.
- `deleteFromBasket()` - удаление товара из корзины
- `isInBasket()` - получение списка товаров в корзине
- `getNumberBasket()` - вывод количества товаров в корзине
- `getTotalBasket()` - вывод итоговой стоимости товаров в корзине
- `cleanBasket()` - очищаение корзины
- `getTotalBasket()` - отображение суммы всех товаров в корзине
- `setField()` - ввод данных в поле заказа
- `setOrderErrors()` - проверка данных адреса и способа оплаты для заказа
- `setContactsErrors()` - проверка данных эмейла и номера телефона для заказа
- `clearErrors()` - очищение сообщений о ошибках форм

#### Model

Класс представляет собой базовую модель данных, которая может быть используется для создания других моделей.

Конструктор класса принимает объект data, который содержит начальные значения модели, и объект events.

Методы:

- `emitChanges` используется для отправки событий, связанных с изменениями модели.

#### Абстрактный класс Component

Класс является абстрактным базовым классом для создания компонентов пользовательского интерфейса. Он предоставляет общие методы для управления элементами DOM и взаимодействия с ними и отрисовке на странице
Конструктор:

`-constructor(container: HTMLElement, events: IEvents)` - конструктор принимает принимает DOM-элемент и экземпляр класса EventEmmiter

`-container: HTMLElement` - DOM-элемент контейнера

`events: IEvents` - брокер событий

Методы:

- `toggleClass` - Метод для переключения CSS класса у элемента.

- `setText` - Устанавливает текстовое содержимое элемента. Принимает любой тип данных и преобразует его в строку.

- `setDiabled` - Изменяет атрибут disabled элемента в зависимости от переданного булевого значения state.

- `setHidden` и - `setVisible` - Методы для управления видимостью элемента, изменяя свойство display CSS.

- `setImage` - Устанавливает атрибуты src и alt для элемента HTMLImageElement, позволяя изменять изображение и его альтернативный текст.

- `render` - Возвращает корневой элемент DOM компонента. Может принимать необязательный параметр data для обновления состояния компонента перед рендерингом.

Этот класс предназначен для наследования и расширения его функциональности в конкретных компонентах пользовательского интерфейса. Он обеспечивает базовый набор инструментов для работы с DOM, что упрощает создание и управление компонентами.

#### Basket

Класс Расширяет класс Component. Предназначен для реализации модального окна с формой, содержащей информацию о выбранных для оформления товарах. При сабмите инициирует событие подтверждения данных и переходу к оформлению заказа.

Конструктор:

- `constructor(container: HTMLElement, events: IEvents)` - наследуется от абстрактного класса Modal

Поля:

- `orderButton: HTMLButtonElement` - кнопка подтверждения
- `list: HTMLElement[]` - коллекция всех выбранных товаров
- `total: string` - сумма для оплаты

Методы:

- `get list` - получение списка выбранных товаров
- `set List` - вывод списка выбранных товаров
- `set total` - вывод общей стоимости товаров
- `get total` - геттер, который возвращает общую сумму заказа.

#### Form

Класс представляет форму с возможностью взаимодействия с ее элементами и событиями. Он наследуется от базового компонента Component и имеет следующие методы и свойства:

Конструктор:

- `constructor(container: HTMLFormElement, events: IEvents)` - конструктор класса, который принимает container (HTML-элемент формы) и events.

Поля:

- `submitButton: HTMLButtonElement` - кнопка подтверждения
- `errors: Record<string, HTMLElement>` - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов
- `inputs: NodeListOf<HTMLInputElement>` - коллекции всех полей ввода формы

- `_submitButton: HTMLButtonElement` - защищенное свойство, которое хранит ссылку на HTML-элемент кнопки отправки формы.
- `_contentError: HTMLElement` - защищенное свойство, которое хранит ссылку на HTML-элемент с сообщением об ошибках формы.
- `container: HTMLFormElement` - защищенное свойство, которое хранит ссылку на форму.
- `events: IEvents` - защищенное свойство, которое хранит объект событий для взаимодействия с другими компонентами.

Методы и сэттеры:

- `set errors()` - принимает объект с данными для отображения или скрытия ошибок под полями ввода
- `onInputChange()`- отображает полученный текст ошибки под указанным полем ввода
- `set valid()` - скрывает текст ошибки под указанным полем ввода
- `resetForm()` - очищает поля формы и сбрасывает состояния кнопок при сабмите

#### Product

Класс отвечает за хранение и логику работы с данными карточки продукта. Класс наследуется от абстрактного класса Component.

Конструктор наследуется от абстрактного класса Component.

Поля:

- `id: string` - уникальный номер товара
- `description: string` - описание товара
- `image: string` - изображение товара
- `title: string` - наименование товара
- `category: string` - категория, к которой относится товар
- `price: number` - стоимость товара

Методы:

- `getId()` - получение уникального номера
- `setId()` - установка уникального номера
- `setTitle()` - установка наименования товара
- `setPrice()` - установка стоимости товара
- `setDescription()` - установка описания товара
- `setCategory()` - установка категории товара
- `setImage()` - установка изображения товара
- `setinBasket()` - установка значения добавленности в корзину
- `setIndex()` - установка индекса

#### Page

Класс реализует отобржение корзины с количеством товара в ней и массив карточек товаров. Класс наследуется от абстрактного класса Component, реализует интерфейс Ipage

Конструктор наследуется от абстрактного класса Component.

Поля:

- `counter: number` - счетчик элементов в корзине
- `catalog: HTMLElement` - массив карточек товаров
- `basket: HTMLElement` - корзина с выбранными товарами
- `wrapper: HTMLElement` - главная страница интернет-магазина

Методы:

- `counter()` - управление отображением количества товаров в корзие
- `catalog()` - управление массивом карточек
- `locked()` - управление блокировкой для прокрутки при открытии модального окна

#### Modal

Класс реализует модальное окно, содержит методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру для закрытия модального окна по клику на оверлей или крестик. Класс наследуется от абстрактного класса Component

Конструктор наследуется от абстрактного класса Component

Поля:

- `container: HTMLElement` - переключает модального окна
- `events: IEvents` - брокер событий
- `content: HTMLElement` - контент, находящийся в модальном окне
- `closeButton: HTMLButtonElement`- кнопка закрытия модального окна

Методы:

- `toggleModal()` - присваивает контен модальному окну
- `set content()` - присваивает контен модальному окну
- `set content()` - присваивает контен модальному окну
- `open()` - управляет отображением модального окна - показывает на странице
- `close()` - управляет отображением модального окна - скрывает со страницы
- `render()` - наследует и расширяет метод родительского класса. Возвращает заполненный данными корневой DOM-элемент

#### ModalOrderAddres

Класс предназначен для реализации модального окна с формой, содержащей поле ввода адреса и способов оплаты заказа. При сабмите инициирует событие подтверждения данных для отправки и оплаты заказа. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. Наследуется от класса Form

Конструктор:

- `constructor(container: HTMLElement, events: IEvents)`

Поля:

- `PaymentButton: HTMLButtonElement` - кнопка выбора способа оплаты
- `address: HTMLInputElement` - элемент формы для ввода адреса

Методы:

- `set address()` - устанавливает значение в поле адреса
- `set payment()` - переключает выбранную пользователем кнопку выбора способа оплаты

#### ModalOrderContacs

Класс предназначен для реализации модального окна с формой, содержащей поля ввода телефона и эмейла. При сабмите инициирует событие подтверждения данных и переход на окно с уведомлением об успешном оформлении заказа. Наследуется от класса Form

Конструктор:

- `constructor(container: HTMLElement, events: IEvents)`

Поля класса:

- `email: HTMLInputElement` - поле ввода эмейла
- `phone: HTMLInputElement` - поле ввода номера телефона

Методы:

- `set email()` - устанавливает значение в поле почтового адреса
- `set phone()` - устанавливает значение в поле контактного телефона

#### ModalOrderDone

Класс наследуется от класса Component. Предназначен для реализации модального окна с формой, содержащей сообщение об успешном оформлении заказа, в которое передаётся полная стоимость корзины.

Конструктор:

- `constructor(container: HTMLElement, events: IEvents)`

Поля класса:

- `closeButton: HTMLButtonElement` - кнопка закрытия формы при успешном оформлении заказа
- `total: number` - общая сумма покупки
- `description: HTMLElement` - сообщение об успешном оформлении заказа

Методы:

- `set total()` - устанавливает значение в поле общей суммы заказа

#### Слой P

отвечает за связывание слоя Model и слоя Viev

На странице происходят следующие события:

- `items:changed ` - событие, которое генерируется при изменении списка товаров.
- `productCard:select` - событие, которое генерируется при выборе товара в каталоге.
- `productCard:remove` - событие, которое генерируется при удалении товара из корзины.
- `productCard:add` - событие, которое генерируется при добавлении товара в корзину.
- `basket:changed` - событие, которое генерируется при изменении данных корзины.
- `basket:open` - событие, которое генерируется при открытии корзины.
- `order:open` - событие, которое генерируется при нажатии на кнопку "Оформить заказ".
- `order:submit` - событие, которое генерируется при отправке формы заказа.
- `formErrors:change` - событие, которое генерируется при изменении состояния валидации формы.
- `contacts:submit` - событие, которое генерируется при отправке формы контактных данных.
- `order:complete` - событие, которое генерируется при успешном оформлении заказа.
- `success:finish` - событие, которое генерируется при закрытии формы успешного оформления заказа.
- `modal:open` - событие, которое генерируется при открытии модального окна. Это событие используется для блокировки прокрутки страницы.
- `modal:close` - событие, которое генерируется при закрытии модального окна. Это событие используется для разблокиировки прокрутки страницы.
- `(order|contacts)\..*:change` - событие, которое генерируется при изменении одного из полей формы заказа или контактных данных.
- `getProductList` - событие, которое генерируется при получении списка товаров с сервера. Это событие используется для заполнения списка товаров на странице
